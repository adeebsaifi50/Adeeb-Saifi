<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>File Share | Adeeb Saifi</title>
<style>
body{font-family:Arial,sans-serif;margin:0;padding:0;background:#121212;color:#fff;display:flex;flex-direction:column;min-height:100vh;}
header{background:#333;text-align:center;padding:20px;}
main{flex:1;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:20px;}
input[type=file]{margin-bottom:10px;padding:10px;border-radius:5px;border:none;}
button{padding:10px 20px;background:#333;color:#fff;border:none;border-radius:5px;cursor:pointer;}
button:hover{background:#555;}
#progress{margin-top:20px;}
#downloadLink{margin-top:20px;word-break:break-all;}
footer{text-align:center;padding:10px;background:#222;color:#ccc;}
</style>
</head>
<body>
<header><h1>Upload Your File</h1></header>
<main>
<input type="file" id="fileInput">
<button id="uploadBtn">Upload</button>
<div id="progress"></div>
<div id="downloadLink"></div>
</main>
<footer><p>&copy; 2025 Adeeb Saifi</p></footer>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-storage-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>

<script>
// ðŸ”¹ Firebase configuration (tumhara app)
const firebaseConfig = {
  apiKey: "AIzaSyAZKAnwU3X0AM1qDTJuiIp5ludQhpoZDTk",
  authDomain: "filebin-clone.firebaseapp.com",
  projectId: "filebin-clone",
  storageBucket: "filebin-clone.firebasestorage.app",
  messagingSenderId: "646204152151",
  appId: "1:646204152151:web:e9ef02afa37fd5ddf20612",
  measurementId: "G-BLL16Q8N9T"
};

// Initialize Firebase
firebase.initializeApp(firebaseConfig);
const storage = firebase.storage();
const db = firebase.firestore();

// DOM Elements
const fileInput = document.getElementById('fileInput');
const uploadBtn = document.getElementById('uploadBtn');
const progressDiv = document.getElementById('progress');
const downloadLinkDiv = document.getElementById('downloadLink');

// ðŸ”¹ Upload Function
uploadBtn.addEventListener('click', () => {
  const file = fileInput.files[0];
  if(!file){ alert('Please select a file'); return; }

  progressDiv.textContent = 'Uploading...';

  const storageRef = storage.ref('uploads/' + file.name);
  const uploadTask = storageRef.put(file);

  uploadTask.on('state_changed',
    snapshot => {
      const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
      progressDiv.textContent = 'Upload is ' + progress.toFixed(2) + '% done';
    },
    error => {
      console.error('Upload failed:', error);
      progressDiv.textContent = 'Upload failed. Try again.';
    },
    () => {
      uploadTask.snapshot.ref.getDownloadURL().then(downloadURL => {
        const now = firebase.firestore.Timestamp.now();
        const expireTime = firebase.firestore.Timestamp.fromDate(new Date(Date.now() + 7*24*60*60*1000));

        // Save metadata in Firestore
        db.collection('files').add({
          fileName: file.name,
          downloadURL,
          uploadTime: now,
          expireTime
        });

        progressDiv.textContent = 'Upload complete!';
        downloadLinkDiv.innerHTML = `<a href="${downloadURL}" target="_blank">Download your file</a>`;
      });
    }
  );
});
</script>
</body>
  </html>
